"use strict";function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class Marker{constructor(e,t){_defineProperty(this,"_getNewMark",()=>{let e=++this.markNumber,t=document.createElement("style"),r=`marker-${this.name}-${e}`;return t.innerHTML=`.${r} {background-color: ${this.color}}`,document.body.appendChild(t),{className:r,markNumber:e,disableHandler:()=>{t.innerHTML=`.${r} {background-color: white}`},enableHandler:()=>{t.innerHTML=`.${r} {background-color: ${this.color}}`},changeColor:e=>{this.color=e,t.innerHTML=`.${r} {background-color: ${this.color}}`}}}),_defineProperty(this,"_markTextNode",(e,t=-1,r=-1,n,i)=>{if("#text"!=e.nodeName)return e;let o=e.parentNode,l=document.createElement("mark");if(l.classList.add(n),l.onclick=i,-1==r&&-1==t)l.appendChild(e.cloneNode()),o.replaceChild(l,e);else if(-1==r)l.appendChild(document.createTextNode(e.textContent.slice(t))),o.insertBefore(document.createTextNode(e.textContent.slice(0,t)),e),o.replaceChild(l,e);else if(-1==t){l.appendChild(document.createTextNode(e.textContent.slice(0,r)));let t=document.createTextNode(e.textContent.slice(r));o.replaceChild(t,e),o.insertBefore(l,t)}else{l.appendChild(document.createTextNode(e.textContent.slice(t,r)));let n=document.createTextNode(e.textContent.slice(0,t)),i=document.createTextNode(e.textContent.slice(r));o.replaceChild(i,e),o.insertBefore(n,i),o.insertBefore(l,i)}return l.firstChild}),_defineProperty(this,"_recursiveMark",(e,t,r=null,n=null)=>{if("#text"==e.nodeName)this._markTextNode(e,-1,-1,r,n);else{let i=e.firstChild,o=!1;for(;i;){if(i===t)return!0;let e=i.nextSibling;if(o=this._recursiveMark(i,t,r,n))return o;i=e}}return!1}),_defineProperty(this,"markText",(e,t,r,n)=>{[e,t,r,n]=this._correctOrdering(e,t,r,n);let i=this._getNewMark();if(e===r)this._markTextNode(e,t,n,i.className,i.disableHandler);else{e=this._markTextNode(e,t,-1,i.className,i.disableHandler),r=this._markTextNode(r,-1,n,i.className,i.disableHandler);let o=e;for(;o.parentNode;){let e=o.parentNode;for(;o.nextSibling;){if(this._recursiveMark(o.nextSibling,r,i.className,i.disableHandler))return;o=o.nextSibling}o=e}}return{disableHandler:i.disableHandler,enableHandler:i.enableHandler,changeColor:i.changeColor}}),_defineProperty(this,"markSelectedText",()=>{let e=getSelection(),t=this.markText(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset);return e.removeAllRanges(),t}),this.color=e,this.name=t,this.markNumber=-1,this.marks=[]}_correctOrdering(e,t,r,n){let i=e.compareDocumentPosition(r);return(!i&&t>n||i===Node.DOCUMENT_POSITION_PRECEDING)&&([e,t,r,n]=[r,n,e,t]),[e,t,r,n]}}